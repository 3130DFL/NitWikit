---
sidebar_position: 6
---

# 什么是启动脚本

启动脚本主要部分就是设置 Java 参数设置。对于 Windows 服务器来说，启动脚本是 `.bat` 后缀的文件，对 Linux 服务器而言，启动脚本是 `.sh` 后缀的文件。

`sh` 和 `bat` 是两种不同操作系统环境下用于执行脚本的文件扩展名，它们的主要区别在于运行环境、语法的不同：

## SH (Shell Script)（Linux)

* 语法: SH脚本使用Shell命令和控制结构，支持条件判断、循环、函数定义等高级编程特性。
* 执行方式: 在终端通过 `./script.sh` 或 `sh script.sh` 来执行（确保脚本具有执行权限）。

## BAT (Batch File)(Windows)

* 语法: BAT脚本包含一系列DOS命令和批处理命令，支持简单的条件判断和循环，但相比SH脚本，其功能和灵活性较低。
* 执行方式: 双击文件或者在命令提示符下输入 `script.bat` 来执行。

# 什么是启动参数

启动参数（也称 Flag）主要分为3类：

* 标准参数（-）：所有的 JVM 实现都必须实现这些参数的功能，而且向后兼容；
* 非标准参数（-X）：默认 JVM 实现这些参数的功能，但是并不保证所有 JVM 实现都满足，且不保证向后兼容；
* 非Stable参数（-XX）：此类参数各个 JVM 实现会有所不同，将来可能会随时取消，需要慎重使用；

以本人经常使用的基于 Aikar Flag 举个例子：

```bash
@ECHO OFF
java -Xms12G -Xmx12G -XX:+UseG1GC -XX:+ParallelRefProcEnabled -XX:MaxGCPauseMillis=200 -XX:+UnlockExperimentalVMOptions -XX:+UnlockDiagnosticVMOptions -XX:+DisableExplicitGC -XX:+AlwaysPreTouch -XX:G1NewSizePercent=30 -XX:G1MaxNewSizePercent=40 -XX:G1HeapRegionSize=8M -XX:G1ReservePercent=20 -XX:G1HeapWastePercent=5 -XX:G1MixedGCCountTarget=4 -XX:InitiatingHeapOccupancyPercent=15 -XX:G1MixedGCLiveThresholdPercent=90 -XX:G1RSetUpdatingPauseTimePercent=5 -XX:SurvivorRatio=32 -DPaper.printStacktraceOnBadPluginClassAccess=false -Dpaper.alwaysPrintWarningState=false -Duser.timezone=GMT+08 -Dfile.encoding=UTF-8 -Xlog:async --enable-preview --add-opens=java.base/java.lang=ALL-UNNAMED --add-modules=jdk.incubator.vector -jar 核心名.jar nogui
pause
```

有点长，但是我会一个个讲解他们的作用

## 基础

```bash
java -Xms12G -Xmx12G -jar 核心名.jar nogui
```

| 参数|说明 |
| :-----------* | :-----------* |
| -Xmx[size] | 设置最大内存大小，默认为物理内存的1/4或者1G，需大于2M，可以指定单位K/M/G|
| -Xms[size] | 设置最小内存大小，默认为物理内存的1/64，需大于1M |
| -jar | 为 Java 指定需要运行的 Jar 程序 |
| nogui | 关闭服务器 GUI，少量性能提升，大多数人不需要用到 |

:::info

1. 无论什么时候，分配内存时一定要多预留15%左右内存，如服务器还剩余 10G 内存， 不要将 -Xms 设置到大于 9G 的内存，否则会很危险。
2. 在 G1GC 模式下，尽量保证 Xmx = Xms 因为如果二者不同 JVM 需要更多的内存时候，JVM需要申请更多内存，这个过程的耗时会导致顿卡。

:::


### 其他参数

## 配置好的启动参数

**不要忘记改最后的“核心名.jar!**
**不要忘记改最后的“核心名.jar!**
**不要忘记改最后的“核心名.jar!**

重要的事情说三遍xd

建议使用下面的脚本，将`-Xms`与`-Xmx`的大小设置相同

```bash
@ECHO OFF
java -server -Xms8g -Xmx8g -XX:+AggressiveOpts -XX:+UseFastAccessorMethods -XX:+UseG1GC -XX:SurvivorRatio=6 -XX:G1ReservePercent=15 -XX:ParallelGCThreads=4 -XX:ConcGCThreads=1 -XX:InitiatingHeapOccupancyPercent=40 -jar 核心名.jar
pause
```

#### 如何设置自动重启

(你也可以使用笨蛋脚本自动生成)

对于 Windows `start.bat` 可参考的脚本如下：

```bash
@ECHO OFF
:start
java ...... -jar 核心名.jar
goto start
```

对于 Linux `start.bat` 可参考的脚本如下：

```bash
while [ true ]; do
    java ...... -jar 核心名.jar
    echo 服务器自动重启中
    echo 同时按下 CTRL + C 关服.
done
```
